name: "Create Pull Request"
description: "Generic PR creation workflow"

params:
  base_branch: "main"
  draft: false
  use_ai: false  # Set to true to use AI for PR description generation

steps:
  - id: git_status
    name: "Check Git Status"
    plugin: git
    step: get_status

  - hook: before_commit

  - id: prompt_for_commit
    name: "Prompt for Commit Message"
    plugin: git
    step: prompt_for_commit_message

  - id: create_commit
    name: "Create Commit"
    plugin: git
    step: create_commit
    # Dependency: 'commit_message' is required by this step, but only if there are
    # changes to commit. The step handles skipping if the working directory is clean.

  - hook: before_push

  - id: push
    name: "Push to Remote"
    plugin: git
    step: push
    # Dependency: This step automatically skips if no new commit (commit_hash)
    # was created by the 'create_commit' step.

  - id: get_base_branch
    name: "Get Base Branch"
    plugin: git
    step: get_base_branch

  - id: get_head_branch
    name: "Get Head Branch"
    plugin: git
    step: get_current_branch

  # AI suggests PR title and body (only runs if use_ai=true, deterministic by default)
  - id: ai_suggest_pr
    name: "AI Suggest PR Description"
    plugin: github
    step: ai_suggest_pr_description
    optional: true  # Skips if use_ai=false or AI not configured, falls back to manual prompts

  - id: prompt_pr_title
    name: "Prompt for PR Title"
    plugin: github
    step: prompt_for_pr_title

  - id: prompt_pr_body
    name: "Prompt for PR Body"
    plugin: github
    step: prompt_for_pr_body

  - id: create_pr
    name: "Create Pull Request"
    plugin: github
    step: create_pr
    # Dependency: This step automatically skips if no new commit (commit_hash)
    # was created, as there would be nothing to push or create a PR for.

  - hook: after_pr