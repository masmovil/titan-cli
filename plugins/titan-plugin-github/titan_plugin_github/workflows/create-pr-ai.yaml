name: "Create Pull Request with AI"
description: "AI-powered PR creation with intelligent commit strategy and analysis"

params:
  draft: false

steps:
  - id: git_status
    name: "Check Git Status"
    plugin: git
    step: get_status

  # Get current branch first
  - id: get_head_branch
    name: "Get Head Branch"
    plugin: git
    step: get_current_branch

  - hook: before_commit

  # AI generates commit message for all changes
  - id: ai_commit_message
    name: "AI Generate Commit Message"
    plugin: git
    step: ai_generate_commit_message

  # Create commit with AI-generated message
  - id: create_commit
    name: "Create Commit"
    plugin: git
    step: create_commit

  - hook: before_push

  - id: push
    name: "Push to Remote"
    plugin: git
    step: push

  # After commits are made and pushed, analyze branch for PR description
  - id: platform_agent_analyze
    name: "AI Generate PR Description"
    plugin: github
    step: ai_suggest_pr_description

  # Fallback to manual prompts if AI was rejected
  - id: prompt_pr_title
    name: "Prompt for PR Title"
    plugin: github
    step: prompt_for_pr_title

  - id: prompt_pr_body
    name: "Prompt for PR Body"
    plugin: github
    step: prompt_for_pr_body

  - id: create_pr
    name: "Create Pull Request"
    plugin: github
    step: create_pr
    requires:
      - pr_title
      - pr_head_branch

  - hook: after_pr
