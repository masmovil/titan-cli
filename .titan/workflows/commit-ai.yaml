name: "Commit with AI, Linter and Tests"
description: "Create a commit with AI-generated message, with linting and testing."

steps:
    # Step 1: Run linter (from old create-pr-ai.yaml hook)
    - id: ruff-lint
      name: "Run Ruff Linter"
      plugin: project
      step: ruff_linter
      on_error: continue

    # Step 2: Offer AI help for linting (optional)
    - id: ai-help-lint
      name: "AI Help - Linting"
      plugin: core
      step: ai_code_assistant
      params:
        context_key: "step_output"
        prompt_template: "Help me fix these linting issues:\n\n{context}"
        ask_confirmation: true
        fail_on_decline: false
      on_error: continue

    # Step 3: Run tests (from old create-pr-ai.yaml hook)
    - id: run-tests
      name: "Run Tests"
      plugin: project
      step: test_runner
      on_error: continue

    # Step 4: Offer AI help for tests (MANDATORY if tests fail)
    - id: ai-help-tests
      name: "AI Help - Tests"
      plugin: core
      step: ai_code_assistant
      params:
        context_key: "step_output"
        prompt_template: "Help me fix these failing tests:\n\n{context}"
        ask_confirmation: true
        fail_on_decline: true
      on_error: fail
      
    # Step 5: Capture git status (from github plugin workflow)
    - id: git_status
      name: "Check Git Status"
      plugin: git
      step: get_status

    # Step 6: AI generates commit message (from github plugin workflow)
    - id: ai_commit_message
      name: "AI Commit Message"
      plugin: git
      step: ai_generate_commit_message

    # Step 7: Create commit with AI-generated message (from github plugin workflow)
    - id: create_commit
      name: "Create Commit"
      plugin: git
      step: create_commit
